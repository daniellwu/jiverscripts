<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <link rel=stylesheet href="../../code.css" type="text/css"></head><body><pre><span class='linenumber'>   1</span> <span class="COMM">/*
<span class='linenumber'>   2</span>  * Copyright 2010 Jive Software
<span class='linenumber'>   3</span>  * 
<span class='linenumber'>   4</span>  * Licensed under the Apache License, Version 2.0 (the "License");
<span class='linenumber'>   5</span>  * you may not use this file except in compliance with the License.
<span class='linenumber'>   6</span>  * You may obtain a copy of the License at
<span class='linenumber'>   7</span>  * 
<span class='linenumber'>   8</span>  *     http://www.apache.org/licenses/LICENSE-2.0
<span class='linenumber'>   9</span>  * 
<span class='linenumber'>  10</span>  * Unless required by applicable law or agreed to in writing, software
<span class='linenumber'>  11</span>  * distributed under the License is distributed on an "AS IS" BASIS,
<span class='linenumber'>  12</span>  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class='linenumber'>  13</span>  * See the License for the specific language governing permissions and
<span class='linenumber'>  14</span>  * limitations under the License.
<span class='linenumber'>  15</span>  */</span><span class="WHIT">
<span class='linenumber'>  16</span> 
<span class='linenumber'>  17</span> 
<span class='linenumber'>  18</span> </span><span class="COMM">/*jslint laxbreak:true forin:true browser:true */</span><span class="WHIT">
<span class='linenumber'>  19</span> </span><span class="COMM">/*extern jive */</span><span class="WHIT">
<span class='linenumber'>  20</span> 
<span class='linenumber'>  21</span> </span><span class="NAME">this.jive</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.jive</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  22</span> </span><span class="COMM">/**
<span class='linenumber'>  23</span>  * Namespace grouping together classes and functions that provide
<span class='linenumber'>  24</span>  * object-oriented support.
<span class='linenumber'>  25</span>  *
<span class='linenumber'>  26</span>  * @namespace
<span class='linenumber'>  27</span>  * @name jive.oo
<span class='linenumber'>  28</span>  */</span><span class="WHIT">
<span class='linenumber'>  29</span> </span><span class="NAME">jive.oo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jive.oo</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  30</span> 
<span class='linenumber'>  31</span> </span><span class="COMM">/**
<span class='linenumber'>  32</span>  * An implementation of classical inheritance in JavaScript adapted from [John
<span class='linenumber'>  33</span>  * Resig's Simple JavaScript Inheritance][1].
<span class='linenumber'>  34</span>  *
<span class='linenumber'>  35</span>  * This adaptation supports true protected members and supports class
<span class='linenumber'>  36</span>  * composition via {@link jive.oo.compose}.
<span class='linenumber'>  37</span>  *
<span class='linenumber'>  38</span>  * [1]: http://ejohn.org/blog/simple-javascript-inheritance/  "Simple JavaScript Inheritance"
<span class='linenumber'>  39</span>  *
<span class='linenumber'>  40</span>  * @class
<span class='linenumber'>  41</span>  */</span><span class="WHIT">
<span class='linenumber'>  42</span> </span><span class="NAME">jive.oo.Class</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  43</span> 
<span class='linenumber'>  44</span> </span><span class="COMM">/**
<span class='linenumber'>  45</span>  * Creates a new subclass.  The subclass will also have its own `extend()`
<span class='linenumber'>  46</span>  * method.
<span class='linenumber'>  47</span>  *
<span class='linenumber'>  48</span>  * @function
<span class='linenumber'>  49</span>  * @param   {Function|Object}   definition  definition of the methods and properties of the new class
<span class='linenumber'>  50</span>  * @returns {jive.oo.Class} returns a new subclass
<span class='linenumber'>  51</span>  */</span><span class="WHIT">
<span class='linenumber'>  52</span> </span><span class="NAME">jive.oo.Class.extend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  53</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>  54</span>      * Returns a new object that has the given `obj` as its prototype.  This method
<span class='linenumber'>  55</span>      * can be used to get prototypal inheritance without using the `new` keyword
<span class='linenumber'>  56</span>      * directly.
<span class='linenumber'>  57</span>      *
<span class='linenumber'>  58</span>      * This implementation comes from:
<span class='linenumber'>  59</span>      * http://javascript.crockford.com/prototypal.html
<span class='linenumber'>  60</span>      */</span><span class="WHIT">
<span class='linenumber'>  61</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">create</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Object.create</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  62</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">F</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  63</span> </span><span class="WHIT">        </span><span class="NAME">F.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  64</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">F</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  65</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  66</span> 
<span class='linenumber'>  67</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">initializing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='linenumber'>  68</span> </span><span class="WHIT">      </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fnTest</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/xyz/</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'xyz'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="REGX">/\b_super\b/</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="REGX">/.*/</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  69</span> 
<span class='linenumber'>  70</span> </span><span class="WHIT">    </span><span class="COMM">// Create a new Class that inherits from this class</span><span class="WHIT">
<span class='linenumber'>  71</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">extend</span><span class="PUNC">(</span><span class="NAME">definition</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  72</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_super</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.protected</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  73</span> </span><span class="WHIT">          </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  74</span> 
<span class='linenumber'>  75</span> </span><span class="WHIT">        </span><span class="COMM">// Instantiate a base class (but only create the instance,</span><span class="WHIT">
<span class='linenumber'>  76</span> </span><span class="WHIT">        </span><span class="COMM">// don't run the init constructor)</span><span class="WHIT">
<span class='linenumber'>  77</span> </span><span class="WHIT">        </span><span class="NAME">initializing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  78</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  79</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">public</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">create</span><span class="PUNC">(</span><span class="NAME">this.public</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  80</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">protected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">create</span><span class="PUNC">(</span><span class="NAME">_super</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  81</span> </span><span class="WHIT">        </span><span class="NAME">initializing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  82</span> 
<span class='linenumber'>  83</span> </span><span class="WHIT">        </span><span class="COMM">// Classes are defined by a given function.  Within the function body</span><span class="WHIT">
<span class='linenumber'>  84</span> </span><span class="WHIT">        </span><span class="COMM">// properties assigned to `this` become public members and</span><span class="WHIT">
<span class='linenumber'>  85</span> </span><span class="WHIT">        </span><span class="COMM">// properties assigned to the function's argument become protected</span><span class="WHIT">
<span class='linenumber'>  86</span> </span><span class="WHIT">        </span><span class="COMM">// members.</span><span class="WHIT">
<span class='linenumber'>  87</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">definition</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  88</span> </span><span class="WHIT">            </span><span class="NAME">definition.call</span><span class="PUNC">(</span><span class="NAME">public</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">protected</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  89</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  90</span> </span><span class="WHIT">            </span><span class="COMM">// If an object is given all members of that object become public</span><span class="WHIT">
<span class='linenumber'>  91</span> </span><span class="WHIT">            </span><span class="COMM">// members of the class.</span><span class="WHIT">
<span class='linenumber'>  92</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">definition</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  93</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">definition.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  94</span> </span><span class="WHIT">                    </span><span class="NAME">public</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">definition</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  95</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  96</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  97</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  98</span> 
<span class='linenumber'>  99</span> </span><span class="WHIT">        </span><span class="COMM">// Copy public properties onto the the class definition</span><span class="WHIT">
<span class='linenumber'> 100</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">public</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 101</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">public.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 102</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">public</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 103</span> </span><span class="WHIT">                    </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Public members must be methods - public variables are not allowed: '"</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">"'"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 104</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">protected</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">protected.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 105</span> </span><span class="WHIT">                    </span><span class="NAME">protected</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">public</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 106</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 107</span> </span><span class="WHIT">                    </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Public and protected properties with the same name are not allowed: '"</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">"'"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 108</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 109</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 110</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 111</span> 
<span class='linenumber'> 112</span> </span><span class="WHIT">        </span><span class="COMM">// Wrap methods that call `_super()`</span><span class="WHIT">
<span class='linenumber'> 113</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">protected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 114</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">protected.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='linenumber'> 115</span> </span><span class="WHIT">              </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">protected</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"function"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='linenumber'> 116</span> </span><span class="WHIT">              </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">_super</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"function"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='linenumber'> 117</span> </span><span class="WHIT">              </span><span class="NAME">fnTest.test</span><span class="PUNC">(</span><span class="NAME">protected</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 118</span> </span><span class="WHIT">                </span><span class="NAME">protected</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 119</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 120</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._super</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 121</span> 
<span class='linenumber'> 122</span> </span><span class="WHIT">                        </span><span class="COMM">// Add a new ._super() method that is the same method</span><span class="WHIT">
<span class='linenumber'> 123</span> </span><span class="WHIT">                        </span><span class="COMM">// but on the super-class</span><span class="WHIT">
<span class='linenumber'> 124</span> </span><span class="WHIT">                        </span><span class="NAME">this._super</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_super</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 125</span> 
<span class='linenumber'> 126</span> </span><span class="WHIT">                        </span><span class="COMM">// The method only need to be bound temporarily, so we</span><span class="WHIT">
<span class='linenumber'> 127</span> </span><span class="WHIT">                        </span><span class="COMM">// remove it when we're done executing</span><span class="WHIT">
<span class='linenumber'> 128</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fn.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 129</span> </span><span class="WHIT">                        </span><span class="NAME">this._super</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 130</span> 
<span class='linenumber'> 131</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 132</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 133</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">protected</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 134</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 135</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 136</span> 
<span class='linenumber'> 137</span> </span><span class="WHIT">        </span><span class="COMM">// The dummy class constructor</span><span class="WHIT">
<span class='linenumber'> 138</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 139</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">instance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT">
<span class='linenumber'> 140</span> </span><span class="WHIT">              </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">protectedInstance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">create</span><span class="PUNC">(</span><span class="NAME">Class.protected</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 141</span> 
<span class='linenumber'> 142</span> </span><span class="WHIT">            </span><span class="COMM">// Wrap public methods so that they run in the context of the</span><span class="WHIT">
<span class='linenumber'> 143</span> </span><span class="WHIT">            </span><span class="COMM">// protected instance.</span><span class="WHIT">
<span class='linenumber'> 144</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">proxy</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 145</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 146</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">protectedInstance</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">protectedInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 147</span> </span><span class="WHIT">                    </span><span class="COMM">// Swap return values if the method returns a reference to</span><span class="WHIT">
<span class='linenumber'> 148</span> </span><span class="WHIT">                    </span><span class="COMM">// its receiver.</span><span class="WHIT">
<span class='linenumber'> 149</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">protectedInstance</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">instance</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 150</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 151</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 152</span> 
<span class='linenumber'> 153</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">Class.public</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 154</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">Class.public</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 155</span> </span><span class="WHIT">                    </span><span class="NAME">instance</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">proxy</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 156</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 157</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 158</span> 
<span class='linenumber'> 159</span> </span><span class="WHIT">            </span><span class="COMM">// All construction is actually done in the init method</span><span class="WHIT">
<span class='linenumber'> 160</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">initializing</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">protectedInstance.init</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 161</span> </span><span class="WHIT">                </span><span class="NAME">protectedInstance.init.apply</span><span class="PUNC">(</span><span class="NAME">protectedInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 162</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 163</span> 
<span class='linenumber'> 164</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">instance</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 165</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 166</span> 
<span class='linenumber'> 167</span> </span><span class="WHIT">        </span><span class="COMM">// Populate our constructed prototype object</span><span class="WHIT">
<span class='linenumber'> 168</span> </span><span class="WHIT">        </span><span class="NAME">Class.prototype</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prototype</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 169</span> </span><span class="WHIT">        </span><span class="NAME">Class.public</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">public</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 170</span> </span><span class="WHIT">        </span><span class="NAME">Class.protected</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">protected</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 171</span> </span><span class="WHIT">        </span><span class="NAME">Class.definition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">definition</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 172</span> 
<span class='linenumber'> 173</span> </span><span class="WHIT">        </span><span class="COMM">// Enforce the constructor to be what we expect</span><span class="WHIT">
<span class='linenumber'> 174</span> </span><span class="WHIT">        </span><span class="NAME">Class.constructor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 175</span> </span><span class="WHIT">        </span><span class="NAME">Class.superclass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 176</span> 
<span class='linenumber'> 177</span> </span><span class="WHIT">        </span><span class="COMM">// And make this class extendable</span><span class="WHIT">
<span class='linenumber'> 178</span> </span><span class="WHIT">        </span><span class="NAME">Class.extend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extend</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 179</span> 
<span class='linenumber'> 180</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 181</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 182</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 183</span> </span></pre></body></html>